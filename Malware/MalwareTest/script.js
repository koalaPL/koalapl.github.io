let lists = document.getElementsByClassName("dragObj");
let rightBox = document.getElementById("dragRightBox");
let leftBox = document.getElementById("dragLeftBox");
let centerBox = document.getElementById("dragCentralBox");

const resident = [
  "Trojan",
  "Ransomware",
  "Wirus płyty głównej",
  "Rootkit",
  "Backdoor",
  "Wabbit",
];
const noResident = [
  "SQL/URL injection",
  "Adware",
  "Stealware",
  "Keylogger",
  "Dialer",
  "Cryptomining",
  "Hijacker Browser Helper Object",
  "Wirus Dyskowy klastrowy",
  "Wirus plikowy",
  "Wirus Makro",
  "Wirus telefonu komórkowego",
  "Wirus typu robak",
  "Exploit",
  "Spam",
];

let blocksContent = [];
blocksContent = resident.concat(noResident);
generateBlocks();
function generateBlocks() {
  shuffleArray(blocksContent);
  for (let i = 0; i < blocksContent.length; i++) {
    let el = document.createElement("div");
    el.innerHTML =
      '<div class="dragObj" draggable="true" name="' +
      blocksContent[i] +
      '">' +
      blocksContent[i] +
      "</div>";
    centerBox.appendChild(el);
  }
  document.querySelector("#endTestPage").classList.add("hiddenElement");
}
let points = 0;
function CheckDraggable() {
  for (let list of lists) {
    list.removeEventListener("dragstart", dragStart);
  }
  for (let child of leftBox.children) {
    for (let i = 0; i < resident.length; i++) {
      if (child.getAttribute("name") == resident[i]) {
        child.classList.remove("badListElement");
        child.classList.add("goodListElement");
        points += 0.5;
        break;
      } else {
        child.classList.remove("goodListElement");
        child.classList.add("badListElement");
      }
    }
  }
  for (let child of rightBox.children) {
    for (let i = 0; i < noResident.length; i++) {
      if (child.getAttribute("name") == noResident[i]) {
        child.classList.remove("badListElement");
        child.classList.add("goodListElement");
        points += 0.5;

        break;
      } else {
        child.classList.remove("goodListElement");
        child.classList.add("badListElement");
      }
    }
  }
  quizAnswer();
  dragBox.classList.add("hiddenElement");
  document.querySelector("#endTestPage").classList.remove("hiddenElement");
  sourceCounter()
}
function shuffleArray(arr) {
  arr.sort(() => Math.random() - 0.5);
}
///Draggable functions ///
// Add event listener for dragstart on parent element
for (let list of lists) {
  list.addEventListener("dragstart", dragStart);
}
// Prevent default behavior on dragover event
centerBox.addEventListener("dragover", function (e) {
  e.preventDefault();
});

// Handle drop event for centerBox
centerBox.addEventListener("drop", function (e) {
  let selected = document.getElementById("selected");
  centerBox.appendChild(selected);
  selected.removeAttribute("id");
});

// Prevent default behavior on dragover event
rightBox.addEventListener("dragover", function (e) {
  e.preventDefault();
});

// Handle drop event for rightBox
rightBox.addEventListener("drop", function (e) {
  let selected = document.getElementById("selected");
  rightBox.appendChild(selected);
  selected.removeAttribute("id");
});

// Prevent default behavior on dragover event
leftBox.addEventListener("dragover", function (e) {
  e.preventDefault();
});

// Handle drop event for leftBox
leftBox.addEventListener("drop", function (e) {
  let selected = document.getElementById("selected");
  leftBox.appendChild(selected);
  selected.removeAttribute("id");
});

// Drag start event handler
function dragStart(e) {
  let selected = e.target;
  selected.setAttribute("id", "selected");

  // Add event listener for dragend on selected element
  selected.addEventListener("dragend", function () {
    selected.removeAttribute("id");
  });
}

// slide elements

let pagesTest = new Array();

let dragBox = document.querySelector(".draggableElement");



generateQuests();
function generateQuests() {
  questHTML = "";
  let quizBox = document.querySelector("#quizBox");
  for (let i = 0; i < questions.length; i++) {
    const element = questions[i];
    let questHTMLtag = ` <div class="Quest">
    <span class="question">`+element.question+`</span>
     <span class="answer"><span>A.</span><input type="radio" name="`+element.numb+`" id="`+element.options[0]+element.numb+`" /><label for="`+element.options[0]+element.numb+`">`+element.options[0]+`</label></span>
     <span class="answer"><span>B.</span><input type="radio" name="`+element.numb+`" id="`+element.options[1]+element.numb+`" /><label for="`+element.options[1]+element.numb+`">`+element.options[1]+`</label></span>
     <span class="answer"><span>C.</span><input type="radio" name="`+element.numb+`" id="`+element.options[2]+element.numb+`" /><label for="`+element.options[2]+element.numb+`">`+element.options[2]+`</label></span>
     <span class="answer"><span>D.</span><input type="radio" name="`+element.numb+`" id="`+element.options[3]+element.numb+`" /><label for="`+element.options[3]+element.numb+`">`+element.options[3]+`</label></span></div>`;
    
     questHTML += questHTMLtag;
    
  }
  quizBox.innerHTML = questHTML;
 
  let allQuest = document.querySelectorAll(".Quest");
  for (let i = 0; i < allQuest.length; i++) {
    pagesTest.push(allQuest[i]);
  }
  pagesTest.push(dragBox);
  // shuffleArray(pagesTest);
}
let controlTestPanel = document.querySelector("#controlTestPanel");
let pageTestIndex = 0;
changePageTest();
function next() {
  if (pageTestIndex != pagesTest.length -1) {
    pageTestIndex++;
    changePageTest();
    controlTestPanel.children[1].classList.remove("hiddenElement");
    controlTestPanel.children[2].classList.add("hiddenElement");
  }
  if((pageTestIndex == pagesTest.length -1))
  {
    controlTestPanel.children[1].classList.add("hiddenElement");
    controlTestPanel.children[2].classList.remove("hiddenElement");
  }
}
function previous() {
  if (pageTestIndex != 0) {
    
    changePageTest();
    document.querySelector("#endTestPage").classList.add("hiddenElement");
    controlTestPanel.children[2].classList.add("hiddenElement");
    controlTestPanel.children[1].classList.remove("hiddenElement");
    
    if((pageTestIndex == pagesTest.length -1))
    {
      dragBox.classList.remove("hiddenElement");
    }
    else{
      dragBox.classList.add("hiddenElement");
      
    }
    pageTestIndex--;
  }
}
function changePageTest() {
  
  for (let i = 0; i < pagesTest.length; i++) {
    if (i === pageTestIndex) {
      pagesTest[pageTestIndex].classList.remove("hiddenElement");
    } else {
      pagesTest[i].classList.add("hiddenElement");
    }
  }
  if (pagesTest[pageTestIndex] === dragBox) {
    quizBox.classList.add("hiddenElement");
  } else {
    quizBox.classList.remove("hiddenElement");
  }
  
}
var els4 = document.querySelectorAll('.answer input[type="radio"]:checked, label');


let child2;
let els 
function quizAnswer(){
   els = document.querySelectorAll('.answer input[type="radio"]:checked');
  
  for(let i = 0; i< els.length; i++){
    for(let j = 0; j< questions.length; j++)
    {
      if(els[i].id == questions[j].answer + els[i].id[els[i].id.length-1])
      {
        els[i].parentNode.children[2].classList.remove("badAnsware")
        els[i].parentNode.children[2].classList.add("goodAnsware");
      
          points++;
          break;
      }
      else
      {
        els[i].parentNode.children[2].classList.remove("goodAnsware")
        els[i].parentNode.children[2].classList.add("badAnsware");
        
        continue;
       
      }
    }
  }
  
}
timerTest()
function timerTest(){
  if(getCookie("time") == '')
  {
    document.cookie = "time = "+ Date.now();
  }
  else
  {
    if((Date.now()- getCookie("time")) >= (1000* 60 *60* 10) )
    {
      document.cookie = "points = "
      document.cookie = "time = "
    }
  }
}

function sourceCounter(){
  if(getCookie("points") == '')
{
  document.cookie = "points = "+points;
}
else{
 points = getCookie("points");
}
  
  let max = (questions.length + ((resident.length+noResident.length)/2));
  let ocena = 1;
  let procent = points /max;
  document.querySelector("#points").innerHTML = points;
  document.querySelector("#pointsMax").innerHTML = max;
  console.log(procent);
 
 if(procent >= 0.98) ocena = 6; 
 else if( procent >= 0.9 )ocena = 5; 
 else if( procent >= 0.75)ocena = 4; 
 else if( procent >= 0.60)ocena = 3; 
 else if( procent >= 0.4) ocena = 2; 
    
 
document.querySelector("#ocena").innerHTML= ocena;
}

function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

console.log("Ponowan próba rozwiącania testu za:")
// Set the date we're counting down to
var countDownDate = getCookie("time")+(1000* 60 *60* 10);

// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = Date.now();

  
  var distance =(1000* 60 * 10) - (Date.now()- getCookie("time"));

 
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  
  if(distance <=0)
  {
    document.cookie = "points = "
      document.cookie = "time = "+ Date.now();
    points = 0;
    
  }else{
    
    console.log (minutes + "m " + seconds + "s ");
  }
  
}, 1000);
